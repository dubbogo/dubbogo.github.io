<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="使用 dubbogo-cli 工具" />
	<meta name="description" content="使用 dubbogo-cli 工具" />
	<!-- 网页标签标题 -->
	<title>使用 dubbogo-cli 工具</title>
	<link rel="shortcut icon" href="/img/dubbo.ico"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot=""><header class="header-container header-container-normal"><div class="header-body"><a href="/zh-cn/index.html"><img class="logo" src="/img/dubbo_colorful.png"/></a><div class="search search-normal"><span class="icon-search"></span></div><span class="language-switch language-switch-normal">En</span><div class="header-menu"><img class="header-menu-toggle" src="/img/menu_gray.png"/><ul><li class="menu-item menu-item-normal"><a href="https://dubbo.apache.org">首页</a></li><li class="menu-item menu-item-normal menu-item-normal-active"><a href="https://dubbo.apache.org/zh/docs3-building/golang-sdk/">文档</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/index.html">博客</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/community/index.html">社区</a></li><li class="menu-item menu-item-normal"><a href="/zh-cn/blog/download.html">下载</a></li><li class="menu-item menu-item-normal"><a href="https://dubbo.io">Java</a></li></ul></div></div></header><div class="bar"><div class="bar-body"><img src="/img/docs.png" class="front-img"/><span>文档</span><img src="/img/docs.png" class="back-img"/></div></div><section class="content-section"><div class="sidemenu"><div class="sidemenu-toggle"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png"/></div><ul><li class="menu-item menu-item-level-1"><span>概念</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/concept/what_is_dubbogo.html" target="_self">Dubbo-go 是什么</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>RPC 调用<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/rpc/protocol.html" target="_self">网络协议</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/rpc/multi_language.html" target="_self">多语言 RPC</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/rpc/generic.html" target="_self">泛化调用</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务治理<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/service_management/registry.html" target="_self">服务注册发现</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/service_management/aop_and_extension.html" target="_self">组件加载与可扩展性</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/service_management/visualization.html" target="_self">可视化</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/service_management/graceful_shutdown.html" target="_self">优雅上下线</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/service_management/adaptive_lb.html" target="_self">柔性负载均衡</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>配置<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/config/basic_concept.html" target="_self">配置基本概念</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务网格<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/mesh/proxyless_service_mesh.html" target="_self">无代理服务网格</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>更多<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/more/3.0_feature.html" target="_self">v3 版本新功能</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/more/app_and_interface.html" target="_self">应用与接口的层级关系</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/concept/more/architecture.html" target="_self">架构</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>快速开始</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/quickstart/install.html" target="_self">安装开发环境</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/quickstart/quickstart_triple.html" target="_self">完成一次 RPC 调用</a></li></ul></li><li class="menu-item menu-item-level-1"><span>任务</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务调用<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/timeout.html" target="_self">配置调用超时</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/rpc_metrics.html" target="_self">查看服务调用监控信息</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/tps_limiter.html" target="_self">为服务端设置限流</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/call_java.html" target="_self">与 Dubbo 应用跨语言互通</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/call_grpc.html" target="_self">与 gRPC 应用互通</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/context.html" target="_self">使用 ctx 传递上下文信息</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/generic.html" target="_self">泛化调用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/rpc/error.html" target="_self">异常回传</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>注册中心<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/registry/nacos.html" target="_self">使用 Nacos 作为注册中心</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/registry/multi_registry.html" target="_self">多注册中心</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>配置<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/config/remote_config.html" target="_self">从远程加载配置启动应用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/config/config_api.html" target="_self">使用配置 API 启动应用</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务治理<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/service_management/aop.html" target="_self">自定义服务调用中间件</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/service_management/graceful_shutdown.html" target="_self">优雅上下线</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>服务网格<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/mesh/build.html" target="_self">部署 Istio 环境</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/mesh/app.html" target="_self">在 Istio 环境部署 Dubbo-go 应用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/mesh/traffic_management.html" target="_self">流量管理</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/mesh/ingress.html" target="_self">使用 Pixiu 网关接入 Ingress 流量</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/mesh/gray_deploy.html" target="_self">金丝雀发布</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>可视化<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/visualization/opentelementry.html" target="_self">使用 Opentelementry 协议</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/visualization/logger.html" target="_self">日志</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/visualization/metrics.html" target="_self">基于 Prometheus 的数据上报</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/visualization/tracing.html" target="_self">基于 Jaeger 的链路追踪</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>调试<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/debug/grpc_cli.html" target="_self">使用 grpc_cli 调试 triple 应用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/debug/dubbogo_cli.html" target="_self">使用dubbogo-cli 调试 dubbo 应用</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Pixiu 网关<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/tasks/pixiu/http_triple.html" target="_self">接入 Ingress 流量</a></li></ul></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/tasks/cli/app_template.html" target="_self">应用模板</a></li></ul></li><li class="menu-item menu-item-level-1"><span>示例</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><span>Dubbo-go samples<img style="transform:rotate(-90deg)" class="menu-toggle" src="/img/arrow_down.png"/></span><ul><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/go_java_interactive.html" target="_self">Go-Java 互通</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/config-center-dynamic.html" target="_self">配置中心和配置监听</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/custom-filter.html" target="_self">Filter</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/registry.html" target="_self">注册中心配置</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/exception_response.html" target="_self">Triple 异常回传</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/custom-logger.html" target="_self">日志</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/metrics.html" target="_self">Metrics 数据上报</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/generic.html" target="_self">泛化调用</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/pixiu-nacos-triple.html" target="_self">使用 Pixiu 暴露 Dubbo-go 服务</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/grpc_cli.html" target="_self">使用 grpc_cli 调试 Dubbo-go 服务</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/service-discovery.html" target="_self">应用级服务发现</a></li><li class="menu-item menu-item-level-3"><a href="/zh-cn/docs/user/samples/mesh_router.html" target="_self">路由规则</a></li></ul></li></ul></li><li class="menu-item menu-item-level-1"><span>参考</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/refer/config.html" target="_self">配置项参考</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/refer/use_dubbogo_cli.html" target="_self">dubbogo-cli 工具</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/ecology/ecology.html" target="_self">Dubbo-go 生态项目介绍</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/refer/compatible_version.html" target="_self">适配版本号</a></li></ul></li><li class="menu-item menu-item-level-1"><span>源码解读</span><ul><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/sourcecode/protocol.html" target="_self">网络协议</a></li><li style="height:36px;overflow:hidden" class="menu-item menu-item-level-2"><a href="/zh-cn/docs/user/sourcecode/registry.html" target="_self">注册中心</a></li></ul></li></ul></div><div class="doc-content markdown-body"><h1>dubbogo-cli 工具</h1>
<h2>1. 安装</h2>
<p>dubbogo-cli 是 Apach/dubbo-go 生态的子项目，为开发者提供便利的应用模板创建、工具安装、接口调试等功能，以提高用户的研发效率。</p>
<p>执行以下指令安装dubbogo-cli 至 $GOPATH/bin</p>
<pre><code>go install github.com/dubbogo/dubbogo-cli@latest
</code></pre>
<h2>2. 功能概览</h2>
<p>dubbogo-cli 支持以下能力</p>
<ul>
<li>
<p>应用模板创建</p>
<pre><code>dubbogo-cli newApp .
</code></pre>
<p>在当前目录下创建应用模板</p>
</li>
<li>
<p>Demo 创建</p>
<pre><code>dubbogo-cli newDemo .
</code></pre>
<p>在当前目录下创建 RPC 示例，包含一个客户端和一个服务端</p>
</li>
<li>
<p>编译、调试工具安装</p>
<pre><code>dubbogo-cli install all
</code></pre>
<p>一键安装以下等工具至 $GOPATH/bin</p>
<ul>
<li>
<p>protoc-gen-go-triple</p>
<p>用于 triple 协议接口编译</p>
</li>
<li>
<p>imports-formatter</p>
<p>用于整理代码 import 块。</p>
<p><a href="https://github.com/dubbogo/tools#imports-formatter">import-formatte README</a></p>
</li>
</ul>
</li>
<li>
<p>查看 dubbo-go 应用注册信息</p>
<ul>
<li>
<p>查看 Zookeeper 上面的注册信息, 获取接口及方法列表</p>
<pre><code class="language-bash">$ dubbogo-cli show --r zookeeper --h 127.0.0.1:2181
interface: com.dubbogo.pixiu.UserService
methods: [CreateUser,GetUserByCode,GetUserByName,GetUserByNameAndAge,GetUserTimeout,UpdateUser,UpdateUserByName]
</code></pre>
</li>
<li>
<p>查看 Nacos 上面的注册信息 【功能开发中】</p>
</li>
<li>
<p>查看 Istio 的注册信息【功能开发中】</p>
</li>
</ul>
</li>
<li>
<p>调试 Dubbo 协议接口</p>
</li>
<li>
<p>调试 Triple 协议接口</p>
</li>
</ul>
<h2>3. 功能详解</h2>
<h3>3.1 Demo 应用介绍</h3>
<h4>3.1.1 Demo 创建</h4>
<pre><code>dubbogo-cli newDemo .
</code></pre>
<p>在当前目录下创建Demo, 包含客户端和服务端，该 Demo 展示了基于一套接口，完成一次 RPC 调用。</p>
<p>该Demo 使用直连模式，无需依赖注册中心，server端暴露服务到本地20000端口，客户端发起调用。</p>
<pre><code class="language-shell">.
├── api
│   ├── samples_api.pb.go 
│   ├── samples_api.proto
│   └── samples_api_triple.pb.go
├── go-client
│   ├── cmd
│   │   └── client.go
│   └── conf
│       └── dubbogo.yaml
├── go-server
│   ├── cmd
│   │   └── server.go
│   └── conf
│       └── dubbogo.yaml
└── go.mod
</code></pre>
<h4>3.1.2 运行Demo</h4>
<p>开启服务端</p>
<pre><code>$ cd go-server/cmd
$ go run .
</code></pre>
<p>另一个终端开启客户端</p>
<pre><code>$ go mod tidy
$ cd go-client/cmd
$ go run .

</code></pre>
<p>可看到打印日志</p>
<pre><code>INFO    cmd/client.go:49        client response result: name:&quot;Hello laurence&quot; id:&quot;12345&quot; age:21
</code></pre>
<h3>3.2 应用模板介绍</h3>
<h4>3.2.1 应用模板创建</h4>
<pre><code>dubbogo-cli newApp .
</code></pre>
<p>在当前目录下创建应用模板:</p>
<pre><code>.
├── Makefile
├── api
│   ├── api.pb.go
│   ├── api.proto
│   └── api_triple.pb.go
├── build
│   └── Dockerfile
├── chart
│   ├── app
│   │   ├── Chart.yaml
│   │   ├── templates
│   │   │   ├── _helpers.tpl
│   │   │   ├── deployment.yaml
│   │   │   ├── service.yaml
│   │   │   └── serviceaccount.yaml
│   │   └── values.yaml
│   └── nacos_env
│       ├── Chart.yaml
│       ├── templates
│       │   ├── _helpers.tpl
│       │   ├── deployment.yaml
│       │   └── service.yaml
│       └── values.yaml
├── cmd
│   └── app.go
├── conf
│   └── dubbogo.yaml
├── go.mod
├── go.sum
└── pkg
    └── service
        └── service.go

</code></pre>
<h4>3.2.2 应用模板介绍</h4>
<p>生成项目包括几个目录：</p>
<ul>
<li>
<p>api：放置接口文件：proto文件和生成的.pb.go文件</p>
</li>
<li>
<p>build：放置镜像构建相关文件</p>
</li>
<li>
<p>chart：放置发布用 chart 仓库、基础环境chart 仓库：nacos、mesh（开发中）</p>
</li>
<li>
<p>cmd：程序入口</p>
</li>
<li>
<p>conf：框架配置</p>
</li>
<li>
<p>pkg/service：RPC 服务实现</p>
</li>
<li>
<p>Makefile：</p>
</li>
<li>
<ul>
<li>镜像、helm部署名：</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>IMAGE = <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>y</mi><mi>o</mi><mi>u</mi><msub><mi>r</mi><mi>r</mi></msub><mi>e</mi><mi>p</mi><mi>o</mi><mo>)</mo><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">(your_repo)/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">e</span><span class="mord mathit">p</span><span class="mord mathit">o</span><span class="mclose">)</span><span class="mord mathrm">/</span></span></span></span>(namespace)/$(image_name)
TAG = 1.0.0</li>
</ul>
</li>
</ul>
</li>
<li>
<p>HELM_INSTALL_NAME = dubbo-go-app，helm 安装名，用于 helm install/uninstall 命令。</p>
</li>
<li>
<ul>
<li>提供脚本，例如：</li>
</ul>
</li>
<li>
<ul>
<li>
<ul>
<li>make build # 打包镜像并推送</li>
</ul>
</li>
</ul>
</li>
<li>
<p>make buildx-publish # arm架构本地打包amd64镜像并推送，依赖 docker buildx</p>
</li>
<li>
<p>make deploy  # 通过 helm 发布应用</p>
</li>
<li>
<p>make remove  # 删除已经发布的 helm 应用</p>
</li>
<li>
<p>make proto-gen # api下生成 pb.go 文件</p>
</li>
<li></li>
</ul>
<p>使用应用模板的开发流程</p>
<blockquote>
<p>依赖环境：make、go、helm、kubectl、docker</p>
</blockquote>
<ol>
<li>通过 dubbogo-cli 生成模板</li>
<li>修改api/api.proto</li>
<li>make proto-gen</li>
<li>开发接口</li>
<li>修改 makefile 内 IMAGE 镜像名和 HELM_INSTALL_NAME 发布名</li>
<li>打镜像并推送</li>
<li>修改chart/app/values 内与部署相关的value配置, 重点关注镜像部分。</li>
</ol>
<pre><code>image:
  repository: $(your_repo)/$(namespace)/$(image_name)
  pullPolicy: Always
  tag: &quot;1.0.0&quot;
</code></pre>
<ol start="8">
<li>make deploy, 使用 helm 发布应用。</li>
</ol>
<h3>3.3 以 gRPC 协议调试 dubbo-go 应用</h3>
<h4>3.3.1 简介</h4>
<p>grpc_cli 工具是 gRPC 生态用于调试服务的工具，在 server 开启<a href="https://github.com/grpc/grpc/blob/master/doc/server-reflection.md">反射服务</a>的前提下，可以获取到服务的 proto 文件、服务名、方法名、参数列表，以及发起 gRPC 调用。</p>
<p>Triple 协议兼容 gRPC 生态，并默认开启 gRPC 反射服务，因此可以直接使用 grpc_cli 调试 triple 服务。</p>
<h4>3.3.2 安装grpc_cli</h4>
<blockquote>
<p>后续将由 dubbogo-cli 安装，目前需要用户手动安装</p>
</blockquote>
<p>参考<a href="https://github.com/grpc/grpc/blob/master/doc/command_line_tool.md">grpc_cli 文档</a></p>
<h4>3.3.3 使用 grpc_cli 对 Triple 服务进行调试</h4>
<ol>
<li>查看 triple 服务的接口定义</li>
</ol>
<pre><code class="language-shell"><span class="hljs-meta">$</span><span class="bash"> grpc_cli ls localhost:20001 -l</span>
filename: helloworld.proto
package: org.apache.dubbo.quickstart.samples;
service UserProvider {
  rpc SayHello(org.apache.dubbo.quickstart.samples.HelloRequest) returns (org.apache.dubbo.quickstart.samples.User) {}
  rpc SayHelloStream(stream org.apache.dubbo.quickstart.samples.HelloRequest) returns (stream org.apache.dubbo.quickstart.samples.User) {}
}
</code></pre>
<ol start="2">
<li>查看请求参数类型</li>
</ol>
<p>例如开发者期望测试上述端口的 SayHello 方法，尝试获取HelloRequest的具体定义，需要执行r如下指令，可查看到对应参数的定义。</p>
<pre><code class="language-shell"><span class="hljs-meta">$</span><span class="bash"> grpc_cli <span class="hljs-built_in">type</span> localhost:20001 org.apache.dubbo.quickstart.samples.HelloRequest</span>
message HelloRequest {
  string name = 1 [json_name = "name"];
}
</code></pre>
<ol start="3">
<li>请求接口</li>
</ol>
<p>已经知道了请求参数的具体类型，可以发起调用来测试对应服务。查看返回值是否符合预期。</p>
<pre><code class="language-shell"><span class="hljs-meta">$</span><span class="bash"> grpc_cli call localhost:20001 SayHello <span class="hljs-string">"name: 'laurence'"</span></span>
connecting to localhost:20001
name: "Hello laurence"
id: "12345"
age: 21
Received trailing metadata from server:
accept-encoding : identity,gzip
adaptive-service.inflight : 0
adaptive-service.remaining : 50
grpc-accept-encoding : identity,deflate,gzip
Rpc succeeded with OK status
</code></pre>
<h3>3.4 以 Dubbo 协议调试dubbo-go 应用</h3>
<h4>3.4.1 开启 Dubbo 服务端</h4>
<p>示例：user.go:</p>
<pre><code>func (u *UserProvider) GetUser(ctx context.Context, userStruct *CallUserStruct) (*User, error) {
	fmt.Printf(&quot;=======================\nreq:%#v\n&quot;, userStruct)
	rsp := User{&quot;A002&quot;, &quot;Alex Stocks&quot;, 18, userStruct.SubInfo}
	fmt.Printf(&quot;=======================\nrsp:%#v\n&quot;, rsp)
	return &amp;rsp, nil
}
</code></pre>
<p>服务端开启一个服务，名为GetUser，传入一个CallUserStruct的参数，返回一个User参数
CallUserStruct参数定义：</p>
<pre><code>type CallUserStruct struct {
	ID      string
	Male    bool
	SubInfo SubInfo // 嵌套子结构
}
func (cs CallUserStruct) JavaClassName() string {
	return &quot;com.ikurento.user.CallUserStruct&quot;
}

type SubInfo struct {
	SubID   string
	SubMale bool
	SubAge  int
}

func (s SubInfo) JavaClassName() string {
	return &quot;com.ikurento.user.SubInfo&quot;
}
</code></pre>
<p>User结构定义：</p>
<pre><code>type User struct {
	Id      string
	Name    string
	Age     int32
	SubInfo SubInfo // 嵌套上述子结构SubInfo
}

func (u *User) JavaClassName() string {
	return &quot;com.ikurento.user.User&quot;
}
</code></pre>
<p>开启服务：</p>
<pre><code>cd server`
`source builddev.sh`
`go run .
</code></pre>
<h4>3.4.2 定义请求体 (适配于序列化协议)</h4>
<p>请求体定义为json文件，约定键值均为string
键对应go语言struct字段名例如&quot;ID&quot;、&quot;Name&quot; ，值对应&quot;type@val&quot;
其中type支持string int bool time，val使用string 来初始化，如果只填写type则初始化为零值。 约定每个struct必须有JavaClassName字段，务必与server端严格对应</p>
<p>见userCall.json:</p>
<pre><code>{
  &quot;ID&quot;: &quot;string@A000&quot;,
  &quot;Male&quot;: &quot;bool@true&quot;,
  &quot;SubInfo&quot;: {
    &quot;SubID&quot;: &quot;string@A001&quot;,
    &quot;SubMale&quot;: &quot;bool@false&quot;,
    &quot;SubAge&quot;: &quot;int@18&quot;,
    &quot;JavaClassName&quot;:&quot;string@com.ikurento.user.SubInfo&quot;
  },
  &quot;JavaClassName&quot;: &quot;string@com.ikurento.user.CallUserStruct&quot;
}
</code></pre>
<p>userCall.json将参数CallUserStruct的结构及子结构SubInfo都定义了出来，并且给请求参数赋值。</p>
<p>user.json 同理，作为返回值不需要赋初始值，但JavaClassName字段一定与server端严格对应</p>
<pre><code>{
  &quot;ID&quot;: &quot;string&quot;,
  &quot;Name&quot;: &quot;string&quot;,
  &quot;Age&quot;: &quot;int&quot;,
  &quot;JavaClassName&quot;:  &quot;string@com.ikurento.user.User&quot;,
  &quot;SubInfo&quot;: {
    &quot;SubID&quot;: &quot;string&quot;,
    &quot;SubMale&quot;: &quot;bool&quot;,
    &quot;SubAge&quot;: &quot;int&quot;,
    &quot;JavaClassName&quot;:&quot;string@com.ikurento.user.SubInfo&quot;
  }
}
</code></pre>
<h4>3.4.3 调试端口</h4>
<pre><code>./dubbo-go-cli -h=localhost -p=20001 -proto=dubbo -i=com.ikurento.user.UserProvider -method=GetUser -sendObj=&quot;./userCall.json&quot; -recvObj=&quot;./user.json&quot;
</code></pre>
<p>打印结果：</p>
<pre><code>2020/10/26 20:47:45 Created pkg:
2020/10/26 20:47:45 &amp;{ID:A000 Male:true SubInfo:0xc00006ea20 JavaClassName:com.ikurento.user.CallUserStruct}
2020/10/26 20:47:45 SubInfo:
2020/10/26 20:47:45 &amp;{SubID:A001 SubMale:false SubAge:18 JavaClassName:com.ikurento.user.SubInfo}


2020/10/26 20:47:45 Created pkg:
2020/10/26 20:47:45 &amp;{ID: Name: Age:0 JavaClassName:com.ikurento.user.User SubInfo:0xc00006ec90}
2020/10/26 20:47:45 SubInfo:
2020/10/26 20:47:45 &amp;{SubID: SubMale:false SubAge:0 JavaClassName:com.ikurento.user.SubInfo}


2020/10/26 20:47:45 connected to localhost:20001!
2020/10/26 20:47:45 try calling interface:com.ikurento.user.UserProvider.GetUser
2020/10/26 20:47:45 with protocol:dubbo

2020/10/26 20:47:45 After 3ms , Got Rsp:
2020/10/26 20:47:45 &amp;{ID:A002 Name:Alex Stocks Age:18 JavaClassName: SubInfo:0xc0001241b0}
2020/10/26 20:47:45 SubInfo:
2020/10/26 20:47:45 &amp;{SubID:A001 SubMale:false SubAge:18 JavaClassName:}```
</code></pre>
<p>可看到详细的请求体赋值情况，以及返回结果和耗时。支持嵌套结构</p>
<p>server端打印结果</p>
<pre><code>=======================
req:&amp;main.CallUserStruct{ID:&quot;A000&quot;, Male:true, SubInfo:main.SubInfo{SubID:&quot;A001&quot;, SubMale:false, SubAge:18}}
=======================
</code></pre>
<p>可见接收到了来自cli的数据</p>
<p>下一章：<a href="./quickstart_dubbo.html">【Dubbo 协议快速开始】</a></p>
</div></section><footer class="footer-container"><div class="footer-body"><img src="/img/dubbo_gray.png"/><img class="apache" src="/img/apache_logo.png"/><div class="cols-container"><div class="col col-12"><h3></h3><p></p></div><div class="col col-4"><dl><dt>ASF</dt><dd><a href="http://www.apache.org" target="_self">基金会</a></dd><dd><a href="http://www.apache.org/licenses/" target="_self">证书</a></dd><dd><a href="http://www.apache.org/events/current-event" target="_self">事件</a></dd><dd><a href="http://www.apache.org/foundation/sponsorship.html" target="_self">赞助</a></dd><dd><a href="http://www.apache.org/foundation/thanks.html" target="_self">致谢</a></dd></dl></div><div class="col col-4"><dl><dt>文档</dt><dd><a href="/zh-cn/docs/user/concept/what_is_dubbogo.html" target="_self">快速开始</a></dd><dd><a href="/zh-cn/docs/dev/build.html" target="_self">开发者指南</a></dd><dd><a href="/zh-cn/docs/admin/ops/dubbo-ops.html" target="_self">运维管理</a></dd><dd><a href="https://github.com/dubbogo/dubbogo.github.io/issues/new" target="_self">报告文档问题</a></dd><dd><a href="https://github.com/dubbogo/dubbogo.github.io" target="_self">编辑此文档</a></dd></dl></div><div class="col col-4"><dl><dt>资源</dt><dd><a href="/zh-cn/blog/index.html" target="_self">博客</a></dd><dd><a href="/zh-cn/community/index.html" target="_self">社区</a></dd><dd><a href="https://www.apache.org/security" target="_self">安全</a></dd></dl></div></div><div class="copyright"><span>Copyright © 2018-2020 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation.</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
  <script src="/build/documentation.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112489517-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-112489517-1');
	</script>
</body>
</html>